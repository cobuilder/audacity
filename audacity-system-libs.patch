--- audacity-src-1.3.2-beta/acinclude.m4.orig	2006-12-29 17:01:36.794372000 +0100
+++ audacity-src-1.3.2-beta/acinclude.m4	2006-12-29 17:23:30.465234287 +0100
@@ -48,12 +48,22 @@
                 [Define if libtwolame (MP2 export) support should be enabled])
    fi
 
-   dnl Libtwolame is so new, we should really use our patched local version for now
-   dnl FIXME: Might want to change this at some point of time in the future...
-   LIBTWOLAME_SYSTEM_AVAILABLE="no"
-
    dnl see if libtwolame is available locally
 
+   PKG_CHECK_MODULES(TWOLAME, twolame,
+		     twolame_available_system="yes",
+		     twolame_available_system="no")
+
+   if test "x$twolame_available_system" = "xyes" ; then
+      LIBTWOLAME_SYSTEM_AVAILABLE="yes"
+      LIBTWOLAME_SYSTEM_LIBS="$TWOLAME_LIBS"
+      LIBTWOLAME_SYSTEM_CXXFLAGS="$TWOLAME_CFLAGS"
+      AC_MSG_NOTICE([Twolame libraries are available as system libraries])
+   else
+      LIBTWOLAME_SYSTEM_AVAILABLE="no"
+      AC_MSG_NOTICE([Twolame libraries are NOT available as system libraries])
+   fi
+
    AC_CHECK_FILE(${srcdir}/lib-src/twolame/libtwolame/twolame.h,
                  twolame_h_found="yes",
                  twolame_h_found="no")
@@ -133,7 +151,22 @@
 
    dnl ... but libresample isn't generally installed as a system library...
 
-   LIBRESAMPLE_SYSTEM_AVAILABLE="no"
+   AC_CHECK_LIB(resample, resample_open,
+                libresample_found="yes",
+                libresample_found="no")
+
+   AC_CHECK_HEADER(libresample.h,
+                   libresample_h_found="yes",
+                   libresample_h_found="no")
+
+   if test "x$libresample_found" = "xyes" && test "x$libresample_h_found" = "xyes" ; then
+      LIBRESAMPLE_SYSTEM_AVAILABLE="yes"
+      LIBRESAMPLE_SYSTEM_LIBS=-lresample
+      AC_MSG_NOTICE([Libresample libraries are available as system libraries])
+   else
+      LIBRESAMPLE_SYSTEM_AVAILABLE="no"
+      AC_MSG_NOTICE([Libresample libraries are NOT available as system libraries])
+   fi
 
    dnl see if libresample is available locally
 
